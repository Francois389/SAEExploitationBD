from classes.Calendrier import Calendrier

import os

calendrier = Calendrier("data/ADECal.ics")

calendrier.get_data()

liste_event = calendrier.get_events()

def ajouter_dans_csv(url_file: str, objet, newline: bool = True, delimiter: str = None) -> None:
    """
    Ajouter une cellule dans le fichier CSV donné.

    Paramètres :
        url_file    -> Chemin vers le fichier à modifier
        objet       -> Contenu à insérer
        newline     -> Ajout d'une nouvelle ligne ou non
        delimiter   -> Caractère de délimitation des valeurs
    """

    with open(url_file, 'a', encoding='utf-8') as csv:
        if newline:
            csv.writelines(str(objet) + '\n')
        else:
            csv.writelines(str(objet))
            csv.writelines(str(delimiter))


def creer_cellule(nom: str, newline: bool) -> None:
    """
    Ajout d'une cellule avec des paramètres pré-définis pour le 
    fichier des créneaux.

    Paramètres :
        nom     -> Valeur à insérer
        newline -> Ajout d'une nouvelle ligne ou non
    """

    ajouter_dans_csv(f"{target}/les_creneaux.csv", nom, newline=newline, delimiter=";")

target = "resultat"

try:
    os.remove(f"{target}/les_creneaux.csv")
except:
    pass

#Création en-tête du csv
creer_cellule("date_debut", False)
creer_cellule("date_fin", False)
creer_cellule("intitule", False)
creer_cellule("salle", False)
creer_cellule("groupe", False)
creer_cellule("professeur", True)

#Insertion des données dans le csv
for i, bloc in enumerate(liste_event):
    # on parcours les données renvoyées par la méthode get_data_csv
    # afin de les insérer dans le fichier csv
    for obj in bloc.get_data_csv():
        creer_cellule(obj, False)

    # retour à la ligne pour les prochaines données
    creer_cellule("", True)

    #Barre de progression dans la console
    print(f"completion : {i+1}/{len(liste_event)}     {round(((i+1)/(len(liste_event)))*100, 2)}", end="\r")

    