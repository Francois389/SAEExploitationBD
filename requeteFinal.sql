-- durée d'occupation des salles
SELECT accueil.nom_salle AS 'Nom salle', SUM(HOUR(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))+(MINUTE(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))/60)) AS TempsEnHeure
FROM creneau
INNER JOIN accueil
ON creneau.id_creneau = accueil.id_creneau
WHERE creneau.heure_debut >= STR_TO_DATE('$DateDebut', "%d/%m/%Y") and creneau.heure_fin <= STR_TO_DATE('$DateFin', "%d/%m/%Y")
GROUP BY accueil.nom_salle
ORDER BY SUM(creneau.heure_fin - creneau.heure_debut) DESC;

-- durée d'occupation des salles pour un département donné
SELECT accueil.nom_salle AS "Nom de la salle", SUM(HOUR(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))+(MINUTE(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))/60)) AS TempsPasserDansUneSalle
FROM creneau
INNER JOIN accueil
ON creneau.id_creneau = accueil.id_creneau
INNER JOIN participer
ON creneau.id_creneau = participer.id_creneau
INNER JOIN groupe
ON participer.nom_groupe = groupe.nom_groupe
WHERE nom_departement = '$Departement'
and creneau.heure_debut >= STR_TO_DATE('$DateDebut', "%d/%m/%Y") and creneau.heure_fin <= STR_TO_DATE('$DateFin', "%d/%m/%Y")
GROUP BY fdesaintpalais.accueil.nom_salle
ORDER BY TempsPasserDansUneSalle DESC;

-- durée d'occupation des salles par département
SELECT groupe.nom_departement AS 'Nom departement', SUM(HOUR(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))+(MINUTE(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))/60)) AS TempsPasserDansSalle
FROM creneau
INNER JOIN accueil
ON creneau.id_creneau = accueil.id_creneau
INNER JOIN participer
ON creneau.id_creneau = participer.id_creneau
INNER JOIN groupe
ON participer.nom_groupe = groupe.nom_groupe
WHERE creneau.heure_debut >= STR_TO_DATE('$DateDebut', "%d/%m/%Y") and creneau.heure_fin <= STR_TO_DATE('$DateFin', "%d/%m/%Y")
GROUP BY groupe.nom_departement
ORDER BY TempsPasserDansSalle DESC;

-- Moyenne et dispersion de la durée d’occupation d’une salle par jour de la semaine
CREATE OR REPLACE VIEW NbHeureParSalleParJour AS
SELECT FROM_DAYS(TO_DAYS(creneau.heure_debut)) AS UnJour ,  salle.nom_salle,
      SUM(HOUR(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))+(MINUTE(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))/60))/(COUNT(creneau.heure_debut)/7)
       AS Temps

FROM salle
JOIN accueil ON salle.nom_salle = accueil.nom_salle
JOIN creneau ON creneau.id_creneau = accueil.id_creneau

and creneau.heure_debut >= STR_TO_DATE('03/02/2022', "%d/%m/%Y") and creneau.heure_fin <= STR_TO_DATE('05/09/2023', "%d/%m/%Y")
GROUP BY FROM_DAYS(TO_DAYS(creneau.heure_debut)),salle.nom_salle;
SELECT  DayName(Vue.UnJour) AS JourDeLaSemaine, AVG(Vue.Temps)
FROM NbHeureParSalleParJour Vue
WHERE Vue.nom_salle = 'A304'
GROUP  BY WEEKDAY(Vue.UnJour);

-- Charge (durée totale d’enseignements) moyenne hebdomadaire pour un groupe donné


--  Pour un département donné, proportion d’occupation de salles informatiques