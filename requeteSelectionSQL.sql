--Pour inserer des dates depuis le format 2015-01-01 00:00:00 il faut utiliser la fonction STR_TO_DATE comme suit:
--STR_TO_DATE(date,'%Y-%m-%d %T')
--rempalcer date par la date a inserer


-- durée d'occupation des salles
SELECT accueil.nom_salle AS 'Nom salle', SUM(HOUR(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))+(MINUTE(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))/60)) AS TempsEnHeure
FROM creneau
INNER JOIN accueil
ON creneau.id_creneau = accueil.id_creneau
WHERE creneau.heure_debut >= STR_TO_DATE('$DateDebut', "%d/%m/%Y") and creneau.heure_fin <= STR_TO_DATE('$DateFin', "%d/%m/%Y")
GROUP BY accueil.nom_salle
ORDER BY SUM(creneau.heure_fin - creneau.heure_debut) DESC;


-- durée d'occupation des salles pour un département donné
SELECT accueil.nom_salle AS "Nom de la salle", SUM(HOUR(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))+(MINUTE(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))/60)) AS TempsPasserDansUneSalle
FROM creneau
INNER JOIN accueil
ON creneau.id_creneau = accueil.id_creneau
INNER JOIN participer
ON creneau.id_creneau = participer.id_creneau
INNER JOIN groupe
ON participer.nom_groupe = groupe.nom_groupe
WHERE nom_departement = '$Departement' 
and creneau.heure_debut >= STR_TO_DATE('$DateDebut', "%d/%m/%Y") and creneau.heure_fin <= STR_TO_DATE('$DateFin', "%d/%m/%Y")
GROUP BY fdesaintpalais.accueil.nom_salle
ORDER BY TempsPasserDansUneSalle DESC;
-- departement parmis ceux la 
-- Informatique
-- GEA
-- Information communication
-- QLIO
-- Carrieres juridiques
-- Null

-- HOUR(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))+(MINUTE(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))/60)



-- durée d'occupation des salles par département
SELECT groupe.nom_departement AS 'Nom departement', SUM(HOUR(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))+(MINUTE(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))/60)) AS TempsPasserDansSalle
FROM creneau
INNER JOIN accueil
ON creneau.id_creneau = accueil.id_creneau
INNER JOIN participer
ON creneau.id_creneau = participer.id_creneau
INNER JOIN groupe
ON participer.nom_groupe = groupe.nom_groupe
WHERE creneau.heure_debut >= STR_TO_DATE('$DateDebut', "%d/%m/%Y") and creneau.heure_fin <= STR_TO_DATE('$DateFin', "%d/%m/%Y")
GROUP BY groupe.nom_departement
ORDER BY TempsPasserDansSalle DESC;


-- charge moyenne hedomadaire pour un groupe donné
-- Il faut faire la somme des heure de cours dans la salle par jour et diviser par le nombre de jour de la période.
-- WEEKDAY
SELECT DAYNAME(creneau.heure_debut) AS JourDeLaSemaine, 
AVG(HOUR(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))+(MINUTE(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))/60)) AS TempsOccupationMoyen
FROM creneau
GROUP BY WEEKDAY(creneau.heure_debut);

---------
SELECT DAYNAME(creneau.heure_debut) AS JourDeLaSemaine, 
SUM(HOUR(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))+(MINUTE(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))/60)) AS TempsOccupationMoyen
FROM salle
JOIN accueil
ON salle.nom_salle = accueil.nom_salle
JOIN creneau
ON creneau.id_creneau = accueil.id_creneau
WHERE salle.nom_salle = '$Salle' 
and creneau.heure_debut >= STR_TO_DATE('$DateDebut', "%d/%m/%Y") and creneau.heure_fin <= STR_TO_DATE('$DateFin', "%d/%m/%Y")
GROUP BY WEEKDAY(creneau.heure_debut);

-------------
SELECT DAYNAME(creneau.heure_debut) AS JourDeLaSemaine, 
       SUM(HOUR(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))+(MINUTE(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))/60))/(COUNT(creneau.heure_debut)/7)
       AS TempsOccupationMoyen
FROM salle
JOIN accueil
ON salle.nom_salle = accueil.nom_salle
JOIN creneau
ON creneau.id_creneau = accueil.id_creneau
WHERE salle.nom_salle = 'A304'
and creneau.heure_debut >= STR_TO_DATE('$DateDebut', "%d/%m/%Y") and creneau.heure_fin <= STR_TO_DATE('$DateFin', "%d/%m/%Y")
GROUP BY WEEKDAY(creneau.heure_debut)

-- Charge (durée totale d’enseignements) moyenne hebdomadaire pour un groupe donné

-- Pour un département donné, proportion d’occupation de salles informatiques
(SELECT 
SUM(HOUR(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))+(MINUTE(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))/60)) AS TempsOccupationMoyen
FROM salle
INNER JOIN accueil
ON accueil.nom_salle = salle.nom_salle
INNER JOIN creneau
ON accueil.id_creneau = creneau.id_creneau
INNER JOIN participer
ON accueil.id_creneau = creneau.id_creneau
INNER JOIN groupe
ON participer.nom_groupe = groupe.nom_groupe
INNER JOIN departement
ON groupe.nom_departement = departement.nom_departement
WHERE salle.est_informatique = 'non'
GROUP BY departement.nom_departement)

-- Resultat :
-- 21319400.0000
-- 34744860.0000
-- 12630304.0000
-- 35044484.0000
-- 864300.0000
-- 17216856.0000

-
(SELECT departement.nom_departement, 
SUM(HOUR(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))+(MINUTE(TIMEDIFF(creneau.heure_fin, creneau.heure_debut))/60)) AS TempsOccupationMoyen
FROM salle
INNER JOIN accueil
ON accueil.nom_salle = salle.nom_salle
INNER JOIN creneau
ON accueil.id_creneau = creneau.id_creneau
INNER JOIN participer
ON accueil.id_creneau = creneau.id_creneau
INNER JOIN groupe
ON participer.nom_groupe = groupe.nom_groupe
INNER JOIN departement
ON groupe.nom_departement = departement.nom_departement
WHERE salle.est_informatique = 'oui'
GROUP BY departement.nom_departement)