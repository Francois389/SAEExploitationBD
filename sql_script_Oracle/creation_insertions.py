import os


def lecture_ecriture_fichier_txt(url_source: str, url_destination: str, index_colonne: int, nom_table: str):
    """
    Lit le fichier texte et écrit le code SQL dans le fichier destination
    Cette fonction est spécifique à la création de la table DEPARTEMENT

    : argument
            url_source -> str : l'url du fichier source
            url_destination -> str : l'url du fichier destination
    """
    if os.path.exists(url_destination):
        os.remove(url_destination)

    with open(url_source, "r", encoding="utf8") as source, open(url_destination, "w", encoding="utf8") as destination:
        lignes_source = source.readlines()
        liste_departement = []
        
        for ligne in lignes_source[1:]:
            ligne = ligne.removesuffix('\n').split('\t')
            
            if ligne[index_colonne] not in liste_departement:
                print(ligne)
                liste_departement.append(ligne[index_colonne])

        for departement in liste_departement:
            requete_sql = f"INSERT INTO {nom_table} (nom_departement) VALUES ('{departement}');"
            print(requete_sql)

            destination.write(requete_sql + "\n")


if __name__ == "__main__":
    lecture_ecriture_fichier_txt(
        "data/groupes.txt", 
        "sql_script_Oracle/insertion/insertion_departement.sql",
    )
